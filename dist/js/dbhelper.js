class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static fetchRestaurants(t){const e=idb.open("restaurant-db",4,function(t){t.objectStoreNames.contains("restaurant-store")||t.createObjectStore("restaurant-store",{keyPath:"id"})});function r(){e.then(t=>t.transaction("restaurant-store").objectStore("restaurant-store").getAll()).then(e=>t(null,e))}fetch(DBHelper.DATABASE_URL).then(function(t){return t.json()}).then(t=>(e.then(e=>{const r=e.transaction("restaurant-store","readwrite"),a=r.objectStore("restaurant-store");for(const e of t)a.put(e);return r.complete}).then(()=>{console.log("restaurants added")}),t)).then(function(e){return t(null,e)}).catch(()=>r())}static fetchRestaurantById(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.find(e=>e.id==t);r?e(null,r):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.cuisine_type==t);e(null,r)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.neighborhood==t);e(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,r){DBHelper.fetchRestaurants((a,n)=>{if(a)r(a,null);else{let a=n;"all"!=t&&(a=a.filter(e=>e.cuisine_type==t)),"all"!=e&&(a=a.filter(t=>t.neighborhood==e)),r(null,a)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].neighborhood),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].cuisine_type),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`/src/img/${t.id}-300_small.jpg`}static imageSrcsetForIndex(t){return`src/images/${t.id}-300_small.jpg 1x, src/images/${t.id}-600_medium_2x.jpg 2x`}static imageSrcsetForRestaurant(t){return`src/images/${t.id}-300_small.jpg 300w, src/images/${t.id}-600_medium_2x.jpg 600w, src/images/${t.id}-800_large_2x.jpg 800w`}static mapMarkerForRestaurant(t,e){const r=new L.marker([t.latlng.lat,t.latlng.lng],{title:t.name,alt:t.name,url:DBHelper.urlForRestaurant(t)});return r.addTo(newMap),r}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwiREFUQUJBU0VfVVJMIiwiW29iamVjdCBPYmplY3RdIiwib2JqZWN0U3RvcmVOYW1lcyIsImRiUHJvbWlzZSIsImlkYiIsIm9wZW4iLCJ1cGdyYWRlREIiLCJjb250YWlucyIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImZldGNoIiwidGhlbiIsImRiIiwiZnVsZmlsbFJlc3VsdCIsImdldERiRGF0YSIsInJlc3RhdXJhbnRzIiwiY2FsbGJhY2siLCJyZXN0YXVyYW50IiwicHV0IiwiY29tcGxldGUiLCJ0eCIsInRyYW5zYWN0aW9uIiwibG9nIiwib2JqZWN0U3RvcmUiLCJyZXN0YXVyYW50U3RvcmUiLCJjYXRjaCIsImNvbnNvbGUiLCJpZCIsImZldGNoUmVzdGF1cmFudHMiLCJlcnJvciIsImZpbmQiLCJyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsIm5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJtYXJrZXIiLCJMIiwibGF0bG5nIiwibGF0IiwibG5nIiwidGl0bGUiLCJuYW1lIiwiYWx0IiwiaW1hZ2VTcmNzZXRGb3JSZXN0YXVyYW50IiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFkZFRvIiwibmV3TWFwIl0sIm1hcHBpbmdzIjoiQUFZQSxNQUFNQSxTQUtKQywwQkFHRSxNQUFRLG9DQWdCRkMsd0JBQWVDLEdBRWQsTUFBQUMsRUFBQUMsSUFBQUMsS0FBQSxnQkFBQSxFQUFBLFNBQUFDLEdBRklBLEVBQVVKLGlCQUFpQkssU0FBUyxxQkFNL0NELEVBQUFFLGtCQUFxQixtQkFBQSxDQUFBQyxRQUFBLFNBZXJCQyxTQUFNWCxJQWRHSSxFQUFVUSxLQUFLQyxH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QixFQUFXK0IsT0FBT0MsSUFBS2hDLEVBQVcrQixPQUFPRSxLQUNwRSxDQUNFQyxNQUFPbEMsRUFBV21DLEtBWHhCQyxJQUFPQyxFQUFBQSxLQUNMQyxJQUFTeEQsU0FBQXlELGlCQUEyQnZDLEtBZXBDLE9BWkY2QixFQUFBVyxNQUFBQyxRQVlTWiIsImZpbGUiOiJkYmhlbHBlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBpZiAoISgnaW5kZXhlZERCJyBpbiB3aW5kb3cpKSB7XHJcbiAgICBjb25zb2xlLmxvZygnVGhpcyBicm93c2VyIGRvZXNuXFwndCBzdXBwb3J0IEluZGV4ZWREQicpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xyXG5jbGFzcyBEQkhlbHBlciB7XHJcbi8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XHJcblxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xyXG5cclxuICAgIC8vIHJldHVybiBgaHR0cHM6Ly9kaW5kZXJhLmdpdGh1Yi5pby8ke3BvcnR9L2RhdGEvcmVzdGF1cmFudHMuanNvbmA7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG5cclxuXHJcblxyXG4gICAgY29uc3QgZGJQcm9taXNlID0gaWRiLm9wZW4oJ3Jlc3RhdXJhbnQtZGInLCA0LCBmdW5jdGlvbiAodXBncmFkZURCKSB7XHJcbiAgICAgIFxyXG4gICAgICAgICAgaWYgKCF1cGdyYWRlREIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucygncmVzdGF1cmFudC1zdG9yZScpKSB7XHJcbiAgICAgICAgICAgIHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudC1zdG9yZScsIHsga2V5UGF0aDogJ2lkJyB9KTtcclxuICAgICAgICAgIH1cclxuIFxyXG4gICAgfSk7XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0RGJEYXRhKCkge1xyXG4gICAgICByZXR1cm4gZGJQcm9taXNlLnRoZW4oZGI9PntcclxuICAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudC1zdG9yZScpXHJcbiAgICAgICAgICAgLm9iamVjdFN0b3JlKCdyZXN0YXVyYW50LXN0b3JlJyk7XHJcbiAgICAgICAgICAgcmV0dXJuIHR4LmdldEFsbCgpO1xyXG4gICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGZ1bGZpbGxSZXN1bHQoKXtcclxuICAgICAgZ2V0RGJEYXRhKCkudGhlbihyZXN0YXVyYW50cyA9PntcclxuICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMKVxyXG4gICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICBjb25zdCByZXN0YXVyYW50cyA9IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICByZXR1cm4gcmVzdGF1cmFudHM7XHJcbiAgICAgIH0pLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgIGRiUHJvbWlzZS50aGVuKGRiID0+IHtcclxuICAgICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnQtc3RvcmUnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICBjb25zdCByZXN0YXVyYW50U3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudC1zdG9yZScpO1xyXG4gICAgICAgICAgZm9yIChjb25zdCByZXN0YXVyYW50IG9mIHJlc3RhdXJhbnRzKSB7XHJcbiAgICAgICAgICAgIHJlc3RhdXJhbnRTdG9yZS5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgICAgfSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygncmVzdGF1cmFudHMgYWRkZWQnKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gcmVzdGF1cmFudHM7XHJcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XHJcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgfSkuY2F0Y2goKCkgPT4ge1xyXG4gICAgICAgICByZXR1cm4gZnVsZmlsbFJlc3VsdCgpO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZCk7XHJcbiAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHsgLy8gR290IHRoZSByZXN0YXVyYW50XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgICB9IGVsc2UgeyAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzXHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSlcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSlcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICAvLyByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgICAvLyBjb25zdCB1cmwgPSAnaHR0cHM6Ly9kaW5kZXJhLmdpdGh1Yi5pby9yZXN0YXVyYW50LXJldmlldy1hcHAvJztcclxuICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgL3NyYy9pbWcvJHtyZXN0YXVyYW50LmlkfS0zMDBfc21hbGwuanBnYCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqICBJbWFnZSBTcmNzZXQgZm9yIEluZGV4IHBhZ2UuXHJcbiAgKi9cclxuICBzdGF0aWMgaW1hZ2VTcmNzZXRGb3JJbmRleChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGBzcmMvaW1hZ2VzLyR7cmVzdGF1cmFudC5pZH0tMzAwX3NtYWxsLmpwZyAxeCwgc3JjL2ltYWdlcy8ke3Jlc3RhdXJhbnQuaWR9LTYwMF9tZWRpdW1fMnguanBnIDJ4YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqICBJbWFnZSBTcmNzZXQgZm9yIFJlc3RhdXJhbnQgcGFnZS5cclxuICAqL1xyXG4gIHN0YXRpYyBpbWFnZVNyY3NldEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgc3JjL2ltYWdlcy8ke3Jlc3RhdXJhbnQuaWR9LTMwMF9zbWFsbC5qcGcgMzAwdywgc3JjL2ltYWdlcy8ke3Jlc3RhdXJhbnQuaWR9LTYwMF9tZWRpdW1fMnguanBnIDYwMHcsIHNyYy9pbWFnZXMvJHtyZXN0YXVyYW50LmlkfS04MDBfbGFyZ2VfMnguanBnIDgwMHdgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIC8vIGh0dHBzOi8vbGVhZmxldGpzLmNvbS9yZWZlcmVuY2UtMS4zLjAuaHRtbCNtYXJrZXIgIFxyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IEwubWFya2VyKFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXHJcbiAgICAgIHtcclxuICAgICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICAgIGFsdDogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KVxyXG4gICAgICB9KVxyXG4gICAgbWFya2VyLmFkZFRvKG5ld01hcCk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuICAvKiBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgbWFwOiBtYXAsXHJcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1B9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9ICovXHJcblxyXG5cclxufVxyXG5cclxuIl19
