"use strict";!function(){function e(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function t(t,n,o){var r,i=new Promise(function(i,u){e(r=t[n].apply(t,o)).then(i,u)});return i.request=r,i}function n(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function o(e,n,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return t(this[n],r,arguments)})})}function r(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function i(e,n,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return e=this[n],(o=t(e,r,arguments)).then(function(e){if(e)return new c(e,o.request)});var e,o})})}function u(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function s(e){this._store=e}function p(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function a(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new p(n)}function f(e){this._db=e}n(u,"_index",["name","keyPath","multiEntry","unique"]),o(u,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(u,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(c,"_cursor",["direction","key","primaryKey","value"]),o(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[t].apply(n._cursor,o),e(n._request).then(function(e){if(e)return new c(e,n._request)})})})}),s.prototype.createIndex=function(){return new u(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new u(this._store.index.apply(this._store,arguments))},n(s,"_store",["name","keyPath","indexNames","autoIncrement"]),o(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),r(s,"_store",IDBObjectStore,["deleteIndex"]),p.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},n(p,"_tx",["objectStoreNames","mode"]),r(p,"_tx",IDBTransaction,["abort"]),a.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},n(a,"_db",["name","version","objectStoreNames"]),r(a,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new p(this._db.transaction.apply(this._db,arguments))},n(f,"_db",["name","version","objectStoreNames"]),r(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[s,u].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),o=n[n.length-1],r=this._store||this._index,i=r[e].apply(r,n.slice(0,-1));i.onsuccess=function(){o(i.result)}})})}),[u,s].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){e?(o.push(e.value),void 0===t||o.length!=t?e.continue():r(o)):r(o)})})})});var d={open:function(e,n,o){var r=t(indexedDB,"open",[e,n]),i=r.request;return i&&(i.onupgradeneeded=function(e){o&&o(new a(i.result,e.oldVersion,i.transaction))}),r.then(function(e){return new f(e)})},delete:function(e){return t(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlkYi5qcyJdLCJuYW1lcyI6WyJwcm9taXNpZnlSZXF1ZXN0IiwicmVxdWVzdCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwib25zdWNjZXNzIiwicmVzdWx0Iiwib25lcnJvciIsImVycm9yIiwicHJvbWlzaWZ5UmVxdWVzdENhbGwiLCJvYmoiLCJtZXRob2QiLCJhcmdzIiwicCIsImFwcGx5IiwidGhlbiIsInByb3BlcnRpZXMiLCJQcm94eUNsYXNzIiwidGFyZ2V0UHJvcCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0IiwicHJvdG90eXBlIiwicHJvcCIsInRoaXMiLCJzZXQiLCJ2YWwiLCJDb25zdHJ1Y3RvciIsImFyZ3VtZW50cyIsInByb3h5TWV0aG9kcyIsImZvckVhY2giLCJwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzIiwidmFsdWUiLCJDdXJzb3IiLCJJbmRleCIsImluZGV4IiwiX2luZGV4IiwiY3Vyc29yIiwiX2N1cnNvciIsIl9yZXF1ZXN0IiwiT2JqZWN0U3RvcmUiLCJzdG9yZSIsIl9zdG9yZSIsInByb3h5UHJvcGVydGllcyIsImlkYlRyYW5zYWN0aW9uIiwiREIiLCJjb21wbGV0ZSIsIm9uY29tcGxldGUiLCJmdW5jTmFtZSIsIlVwZ3JhZGVEQiIsIm9sZFZlcnNpb24iLCJpbnN0YW5jZSIsIml0ZW1zIiwiVHJhbnNhY3Rpb24iLCJ0cmFuc2FjdGlvbiIsIl9kYiIsInByb3h5UmVxdWVzdE1ldGhvZHMiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIm1ldGhvZE5hbWUiLCJJREJPYmplY3RTdG9yZSIsImNyZWF0ZUluZGV4Iiwib2JqZWN0U3RvcmUiLCJkYiIsImNhbGxiYWNrIiwiX3R4IiwiSURCVHJhbnNhY3Rpb24iLCJjcmVhdGVPYmplY3RTdG9yZSIsIklEQkRhdGFiYXNlIiwib251cGdyYWRlbmVlZGVkIiwidXBncmFkZUNhbGxiYWNrIiwiZGVsZXRlIiwibW9kdWxlIiwicmVwbGFjZSIsImFyciIsIkFycmF5Iiwic2xpY2UiLCJjYWxsIiwibGVuZ3RoIiwibmF0aXZlT2JqZWN0IiwiZ2V0QWxsIiwicXVlcnkiLCJjb3VudCIsIml0ZXJhdGVDdXJzb3IiLCJwdXNoIiwidW5kZWZpbmVkIiwiY29udGludWUiLCJleHAiLCJvcGVuIiwibmFtZSIsInZlcnNpb24iLCJpbmRleGVkREIiLCJldmVudCIsImV4cG9ydHMiLCJkZWZhdWx0Iiwic2VsZiIsImlkYiJdLCJtYXBwaW5ncyI6IkFBQUEsY0FFQyxXQUtDLFNBQVNBLEVBQWlCQyxHQUN4QixPQUFPLElBQUlDLFFBQVEsU0FBQUMsRUFBQUMsR0FDakJILEVBQVFJLFVBQVksV0FDbEJGLEVBQVFGLEVBQVFLLFNBR2xCTCxFQUFRTSxRQUFVLFdBQ2hCSCxFQUFPSCxFQUFRTyxVQUtyQixTQUFTQyxFQUFxQkMsRUFBS0MsRUFBUUMsR0FDekMsSUFBSVgsRUFDQVksRUFBSSxJQUFJWCxRQUFRLFNBQUFDLEVBQUFDLEdBRWxCSixFQURBQyxFQUFVUyxFQUFJQyxHQUFRRyxNQUFNSixFQUFLRSxJQUNQRyxLQUFLWixFQUFTQyxLQUszQyxPQURDUyxFQUFBWixRQUFBQSxFQUNEWSxFQVdDRyxTQUFBQSxFQUFtQkMsRUFBZUMsRUFBQUYsR0FDaENHLEVBQU9DLFFBQUFBLFNBQWVILEdBQ3BCSSxPQUFLRCxlQUFXSCxFQUFBSyxVQUFBQyxFQUFBLENBQ2RGLElBQUEsV0FGOEMsT0FBQUcsS0FBQU4sR0FBQUssSUFLOUNFLElBQUEsU0FBS1AsR0FDTk0sS0FBQU4sR0FBQUssR0FBQUcsT0FNTFYsU0FBQUEsRUFBbUJDLEVBQWVDLEVBQUFTLEVBQUFYLEdBQ2hDQSxFQUFNTyxRQUFRSSxTQUFZTCxHQUFwQkMsS0FBUUksRUFBWUwsWUFDMUJMLEVBQVdLLFVBQVVDLEdBQVEsV0FDM0IsT0FBT2QsRUFBcUJlLEtBQUtOLEdBQWFLLEVBQU1LLGVBSzFELFNBQVNDLEVBQWFaLEVBQVlDLEVBQVlTLEVBQWFYLEdBQ3pEQSxFQUFXYyxRQUFRLFNBQUFQLEdBQ1hBLEtBQVFJLEVBQVlMLFlBQzFCTCxFQUFXSyxVQUFVQyxHQUFRLFdBQTdCTixPQUFBQSxLQUFXSyxHQUFYQyxHQUE2QlQsTUFBQVUsS0FBV04sR0FBQVUsZUFNNUMsU0FBU0csRUFBMEJkLEVBQVlDLEVBQVlTLEVBQWFYLEdBQXhFQSxFQUFTZSxRQUFBQSxTQUFBQSxHQUNQZixLQUFXYyxFQUFRUixZQUNqQkwsRUFBVUssVUFBSUssR0FBWUwsV0FFeEIsT0ExQzhCWCxFQTBDSWEsS0FBS04sSUF6QzNDTCxFQUFRSixFQUFNQyxFQXlDMENhLEVBQU1LLFlBeEN2REksS0FBTyxTQUFBQSxHQUNaLEdBQUFBLEVBRkYsT0FBQSxJQUFBQyxFQUFBRCxFQUFBbkIsRUFBQVosV0FEQSxJQUFrQ1UsRUFDbENFLE1BNENELFNBQUFxQixFQUFBQyxHQUdDWCxLQUFLWSxPQUFTRCxFQThDWixTQUFBRixFQUFPL0IsRUFBUUMsR0FDYmtDLEtBQUFBLFFBQU9DLEVBdEJYZCxLQUFLZSxTQUFXdEMsRUE0RWIsU0FGRHVDLEVBQUFDLEdBMUNGakIsS0FBS2tCLE9BQVNELEVBZ0doQkUsU0FBQUEsRUFBb0JDLEdBTXBCZixLQUFBQSxJQUFhZ0IsRUFLYnJCLEtBQUFzQixTQUFBLElBQUE1QyxRQUFBLFNBQUFDLEVBQUFDLEdBakVJd0MsRUFBZUcsV0FBYSxXQWtFL0I1QyxLQUVHeUMsRUFBQXJDLFFBQUEsV0FDQUgsRUFBTTRDLEVBQVlyQixRQUVsQkEsRUFBWUwsUUFBVTBCLFdBQ3BCNUMsRUFBSVEsRUFBZWdCLFVBa0JyQixTQUFBcUIsRUFBVy9DLEVBQVFnRCxFQUFTL0MsR0FDMUJnRCxLQUFBQSxJQUFBQSxFQUNFM0IsS0FBQTBCLFdBQUFBLEVBQ0UvQyxLQUFBQSxZQUFRaUQsSUFBUkMsRUFBQUMsR0FpQk4sU0FBS1QsRUFBR3BDLEdBQ1JlLEtBQUErQixJQUFJdEQsRUFqTlAwQyxFQUFBVCxFQUFBLFNBQUEsQ0FHQyxPQURGUyxVQU9BYSxhQVFBekIsV0FNRXlCLEVBQWVuQixFQUFmLFNBQUFvQixTQUFBLENBQ0EsTUFDRCxTQWJDLFNBZUZkLGFBT0FhLFVBT0V6QixFQUFvQjJCLEVBQVVwQyxTQUE5Qm1DLFNBQTBDLENBdkIxQyxhQXdCQXhCLGtCQU9NVSxFQUFPVixFQUFJQSxVQUFjSSxDQUMxQixZQUNGLE1BQ0YsYUFaSCxVQWdCRW1CLEVBQWNmLEVBQWQsVUFBQWlCLFVBQUEsQ0FDRCxTQXJCQyxXQUlGLENBQUMsVUFBVyxXQUFZLHNCQUFzQjVCLFFBQVEsU0FBUzZCLEdBdUIvRG5CLEtBQXNCTCxVQUFRYixZQUM1QlcsRUFBT1gsVUFBVXFDLEdBQVl4QixXQUQvQixJQUFBRSxFQUFBYixLQW5CUVosRUFBT2dCLFVBdUJmZSxPQUFBQSxRQUFnQkgsVUFBYXpCLEtBQUEsV0FtQjdCZ0IsT0FaQXlCLEVBQUFBLFFBQW9CaEIsR0FBYTFCLE1BQUF1QixFQUFVdUIsUUFBQUEsR0FZM0M3QixFQUEwQlMsRUFBREQsVUFBQXhCLEtBQXdCNkMsU0FBQUEsR0FLakQvQixHQUFhVyxFQTFDTCxPQUFPLElBQUlQLEVBQU9ELEVBQU9LLEVBQU9FLGtCQXNEbkNDLEVBRkRsQixVQUFBdUMsWUFBQSxXQXpDRixPQUFPLElBQUkzQixFQUFNVixLQUFLa0IsT0FBT21CLFlBQVkvQyxNQUFNVSxLQUFLa0IsT0FBUWQsYUE4Q3pEWSxFQUZEbEIsVUFBQWEsTUFBQSxXQUdELE9BVkQsSUFBQUQsRUFBQVYsS0FBQWtCLE9BQUFQLE1BQUFyQixNQUFBVSxLQUFBa0IsT0FBQWQsYUFhRnlCLEVBQVkvQixFQUFVd0MsU0FBYyxDQUNsQyxPQURGLFVBeENFLGFBNENGbkIsa0JBU0FhLEVBQW1CTyxFQUFuQixTQUFtQ1QsZUFBYSxDQUM5QyxNQUNBLE1BQ0EsU0FDRCxRQWhEQyxNQWtERkwsU0FDRSxTQURGLGFBOUNFLFVBR0ZsQixFQUEwQlMsRUFBYSxTQUFVb0IsZUFBZ0IsQ0EwRGpFLGFBQ0Usa0JBR0ZmLEVBQWFTLEVBQWIsU0FBMkJNLGVBQVcsQ0FDcEMsZ0JBeUJJM0QsRUFBQUEsVUFBUUksWUFBWSxXQUNsQjJELE9BQUFBLElBQUFBLEVBQWlCMUQsS0FBQUEsSUFBakJ3RCxZQUFBaEQsTUFBQVUsS0FBQXlDLElBQUFyQyxhQUdMZSxFQWJEVSxFQUFBLE1BQUEsQ0FERixtQkFoREUsU0FHRnhCLEVBQWF3QixFQUFhLE1BQU9hLGVBQWdCLENBaUUvQ3ZDLFVBdkRGc0IsRUFBVTNCLFVBQVU2QyxrQkFBb0IsV0FpRWhDZixPQUFBQSxJQUFLWixFQUFZaEIsS0FBQ1EsSUFBbEJtQyxrQkFBQXJELE1BQUFVLEtBQUErQixJQUFBM0IsYUFHRXpCLEVBQUFBLEVBQUEsTUFBQSxDQUNBLE9BQ0QsVUEvRFAscUJBa0VHMEIsRUFkRG9CLEVBQUEsTUFBQW1CLFlBQUEsQ0FlRCxvQkFyQkgsVUE4Qk1uRSxFQUFBQSxVQUFPcUQsWUFBQ2UsV0FDTixPQUFBLElBQUlDLEVBQUFBLEtBQWlCZixJQUFBRCxZQUFBeEMsTUFBQVUsS0FBQStCLElBQUEzQixhQUd0QmUsRUFKREUsRUFBQSxNQUFBLENBS0QsT0EvREgsVUFpRUUscUJBR0RoQixFQWhCT2dCLEVBQUEsTUFBQXVCLFlBQUEsQ0FpQlJHLFVBS0YsQ0FBQSxhQUFXQyxpQkFBVzFDLFFBQWEsU0FBQWtCLEdBQ2pDd0IsQ0FBQUEsRUFBQXRDLEdBQUFKLFFBQUEsU0FBQUgsR0FHR3FCLEtBQUFyQixFQUFBTCxZQUVKSyxFQUFBTCxVQUFBMEIsRUFBQXlCLFFBQUEsT0FBQSxZQUFBLFdBeFRILElBQ21CQyxFQURuQjlELEdBQ21COEQsRUFEbkI5QyxVQUVXK0MsTUFBTXJELFVBQVVzRCxNQUFNQyxLQUFLSCxJQXVQMUJWLEVBQVdwRCxFQUFLQSxFQUFLa0UsT0FBUyxHQUM5QkMsRUFBZXZELEtBQUtrQixRQUFVbEIsS0FBS1ksT0FDbkNuQyxFQUFVOEUsRUFBYS9CLEdBQVVsQyxNQUFNaUUsRUFBY25FLEVBQUtnRSxNQUFNLEdBQUksSUFDeEUzRSxFQUFRSSxVQUFZLFdBQ2xCMkQsRUFBUy9ELEVBQVFLLGVBT3pCLENBQUM0QixFQUFPTSxHQUFhVixRQUFRLFNBQVNILEdBQ2hDQSxFQUFZTCxVQUFVMEQsU0FDMUJyRCxFQUFZTCxVQUFVMEQsT0FBUyxTQUFTQyxFQUFPQyxHQUM3QyxJQUFJL0IsRUFBVzNCLEtBQ1g0QixFQUFRLEdBRVosT0FBTyxJQUFJbEQsUUFBUSxTQUFTQyxHQUMxQmdELEVBQVNnQyxjQUFjRixFQUFPLFNBQVM1QyxHQUNoQ0EsR0FJTGUsRUFBTWdDLEtBQUsvQyxFQUFPTCxZQUVKcUQsSUFBVkgsR0FBdUI5QixFQUFNMEIsUUFBVUksRUFJM0M3QyxFQUFPaUQsV0FITG5GLEVBQVFpRCxJQU5SakQsRUFBUWlELFdBZWxCLElBQUltQyxFQUFNLENBQ1JDLEtBQU0sU0FBU0MsRUFBTUMsRUFBU3BCLEdBQzVCLElBQUl6RCxFQUFJSixFQUFxQmtGLFVBQVcsT0FBUSxDQUFDRixFQUFNQyxJQUNuRHpGLEVBQVVZLEVBQUVaLFFBVWhCLE9BUklBLElBQ0ZBLEVBQVFvRSxnQkFBa0IsU0FBU3VCLEdBQzdCdEIsR0FDRkEsRUFBZ0IsSUFBSXJCLEVBQVVoRCxFQUFRSyxPQUFRc0YsRUFBTTFDLFdBQVlqRCxFQUFRcUQsZ0JBS3ZFekMsRUFBRUUsS0FBSyxTQUFTZ0QsR0FDckIsT0FBTyxJQUFJbEIsRUFBR2tCLE1BR2xCUSxPQUFRLFNBQVNrQixHQUNmLE9BQU9oRixFQUFxQmtGLFVBQVcsaUJBQWtCLENBQUNGLE1BSXhDLG9CQUFYakIsUUFDVEEsT0FBT3FCLFFBQVVOLEVBQ2pCZixPQUFPcUIsUUFBUUMsUUFBVXRCLE9BQU9xQixTQUdoQ0UsS0FBS0MsSUFBTVQsRUF2VGQiLCJmaWxlIjoiaWRiLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuKGZ1bmN0aW9uKCkge1xyXG4gIGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XHJcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xyXG4gICAgdmFyIHJlcXVlc3Q7XHJcbiAgICB2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICByZXF1ZXN0ID0gb2JqW21ldGhvZF0uYXBwbHkob2JqLCBhcmdzKTtcclxuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xyXG4gICAgcmV0dXJuIHA7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xyXG4gICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncyk7XHJcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgIGlmICghdmFsdWUpIHJldHVybjtcclxuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xyXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xyXG4gICAgICAgICAgdGhpc1t0YXJnZXRQcm9wXVtwcm9wXSA9IHZhbDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwcm94eVJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xyXG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcclxuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xyXG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcclxuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xyXG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcclxuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gSW5kZXgoaW5kZXgpIHtcclxuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XHJcbiAgfVxyXG5cclxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbXHJcbiAgICAnbmFtZScsXHJcbiAgICAna2V5UGF0aCcsXHJcbiAgICAnbXVsdGlFbnRyeScsXHJcbiAgICAndW5pcXVlJ1xyXG4gIF0pO1xyXG5cclxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcclxuICAgICdnZXQnLFxyXG4gICAgJ2dldEtleScsXHJcbiAgICAnZ2V0QWxsJyxcclxuICAgICdnZXRBbGxLZXlzJyxcclxuICAgICdjb3VudCdcclxuICBdKTtcclxuXHJcbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXHJcbiAgICAnb3BlbkN1cnNvcicsXHJcbiAgICAnb3BlbktleUN1cnNvcidcclxuICBdKTtcclxuXHJcbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xyXG4gICAgdGhpcy5fY3Vyc29yID0gY3Vyc29yO1xyXG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XHJcbiAgfVxyXG5cclxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcclxuICAgICdkaXJlY3Rpb24nLFxyXG4gICAgJ2tleScsXHJcbiAgICAncHJpbWFyeUtleScsXHJcbiAgICAndmFsdWUnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgW1xyXG4gICAgJ3VwZGF0ZScsXHJcbiAgICAnZGVsZXRlJ1xyXG4gIF0pO1xyXG5cclxuICAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xyXG4gIFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcclxuICAgIGlmICghKG1ldGhvZE5hbWUgaW4gSURCQ3Vyc29yLnByb3RvdHlwZSkpIHJldHVybjtcclxuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgdmFyIGN1cnNvciA9IHRoaXM7XHJcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICBjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XHJcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XHJcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG4gIH0pO1xyXG5cclxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xyXG4gICAgdGhpcy5fc3RvcmUgPSBzdG9yZTtcclxuICB9XHJcblxyXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5jcmVhdGVJbmRleCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XHJcbiAgfTtcclxuXHJcbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcclxuICB9O1xyXG5cclxuICBwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbXHJcbiAgICAnbmFtZScsXHJcbiAgICAna2V5UGF0aCcsXHJcbiAgICAnaW5kZXhOYW1lcycsXHJcbiAgICAnYXV0b0luY3JlbWVudCdcclxuICBdKTtcclxuXHJcbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXHJcbiAgICAncHV0JyxcclxuICAgICdhZGQnLFxyXG4gICAgJ2RlbGV0ZScsXHJcbiAgICAnY2xlYXInLFxyXG4gICAgJ2dldCcsXHJcbiAgICAnZ2V0QWxsJyxcclxuICAgICdnZXRLZXknLFxyXG4gICAgJ2dldEFsbEtleXMnLFxyXG4gICAgJ2NvdW50J1xyXG4gIF0pO1xyXG5cclxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcclxuICAgICdvcGVuQ3Vyc29yJyxcclxuICAgICdvcGVuS2V5Q3Vyc29yJ1xyXG4gIF0pO1xyXG5cclxuICBwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xyXG4gICAgJ2RlbGV0ZUluZGV4J1xyXG4gIF0pO1xyXG5cclxuICBmdW5jdGlvbiBUcmFuc2FjdGlvbihpZGJUcmFuc2FjdGlvbikge1xyXG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcclxuICAgIHRoaXMuY29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgfTtcclxuICAgICAgaWRiVHJhbnNhY3Rpb24ub25lcnJvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XHJcbiAgICAgIH07XHJcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xyXG4gIH07XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcclxuICAgICdvYmplY3RTdG9yZU5hbWVzJyxcclxuICAgICdtb2RlJ1xyXG4gIF0pO1xyXG5cclxuICBwcm94eU1ldGhvZHMoVHJhbnNhY3Rpb24sICdfdHgnLCBJREJUcmFuc2FjdGlvbiwgW1xyXG4gICAgJ2Fib3J0J1xyXG4gIF0pO1xyXG5cclxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XHJcbiAgICB0aGlzLl9kYiA9IGRiO1xyXG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcclxuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xyXG4gIH1cclxuXHJcbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XHJcbiAgfTtcclxuXHJcbiAgcHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFtcclxuICAgICduYW1lJyxcclxuICAgICd2ZXJzaW9uJyxcclxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xyXG4gIF0pO1xyXG5cclxuICBwcm94eU1ldGhvZHMoVXBncmFkZURCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcclxuICAgICdkZWxldGVPYmplY3RTdG9yZScsXHJcbiAgICAnY2xvc2UnXHJcbiAgXSk7XHJcblxyXG4gIGZ1bmN0aW9uIERCKGRiKSB7XHJcbiAgICB0aGlzLl9kYiA9IGRiO1xyXG4gIH1cclxuXHJcbiAgREIucHJvdG90eXBlLnRyYW5zYWN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcclxuICB9O1xyXG5cclxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbXHJcbiAgICAnbmFtZScsXHJcbiAgICAndmVyc2lvbicsXHJcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcclxuICBdKTtcclxuXHJcbiAgcHJveHlNZXRob2RzKERCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcclxuICAgICdjbG9zZSdcclxuICBdKTtcclxuXHJcbiAgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcclxuICAvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXHJcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uKGZ1bmNOYW1lKSB7XHJcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XHJcbiAgICAgIC8vIERvbid0IGNyZWF0ZSBpdGVyYXRlS2V5Q3Vyc29yIGlmIG9wZW5LZXlDdXJzb3IgZG9lc24ndCBleGlzdC5cclxuICAgICAgaWYgKCEoZnVuY05hbWUgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG5cclxuICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xyXG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcclxuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XHJcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xyXG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcclxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XHJcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xyXG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xyXG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xyXG4gICAgICB2YXIgaXRlbXMgPSBbXTtcclxuXHJcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XHJcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XHJcbiAgICAgICAgICBpZiAoIWN1cnNvcikge1xyXG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xyXG5cclxuICAgICAgICAgIGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xyXG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuICB9KTtcclxuXHJcbiAgdmFyIGV4cCA9IHtcclxuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xyXG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xyXG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcclxuXHJcbiAgICAgIGlmIChyZXF1ZXN0KSB7XHJcbiAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xyXG4gICAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcclxuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XHJcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcclxuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICBzZWxmLmlkYiA9IGV4cDtcclxuICB9XHJcbn0oKSk7Il19
